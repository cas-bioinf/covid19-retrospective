---
title: "Developing data load and processing"
output: html_notebook
---

```{r}
devtools::load_all()
library(tidyverse)
```

```{r}
raw_data_dir <- "H:/raw/"
if(!dir.exists(raw_data_dir)) {
  stop("Raw data dir not found")
}

raw_data_map <- readxl::read_excel(paste0(raw_data_dir,"mapping.xlsx"), sheet = "HospitalMapping") %>% filter(!is.na(File))
```


Notes to resolve:
- Missing "Covid medication before hospitalization" in "Old" version.

```{r}
for(i in 1:nrow(raw_data_map)) {
  file_relative <- raw_data_map$File[i]
  hospital_id <- raw_data_map$HospitalID[i]
  lang <- raw_data_map$Lang[i]
  file_version <- raw_data_map$Version[i]
  
  file <- paste0(raw_data_dir, file_relative)
  
  cat("Processing ", i, "-", hospital_id, "\n")
  
  read_raw_data(file, hospital_id, lang, file_version)
}


```


```{r}



```

```{r}


```

```{r}
# TODO check units (and convert if necessary)
marker_data %>% group_by(marker) 

```

